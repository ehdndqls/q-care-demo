<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="pageTitle">Book Appointment - Q-Care</title>
    <link rel="stylesheet" href="/css/appointment.css">
</head>
<body>
<div class="container">
    Header
    <header class="header">
        <div class="header-content">
            <button class="back-btn" onclick="history.back()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 100 100">
                    <path d="M50 15 C30 15, 15 30, 15 50 C15 70, 30 85, 50 85 C70 85, 85 70, 85 50 C85 30, 70 15, 50 15 Z" fill="#164e63"/>
                    <path d="M35 45 L50 30 L65 45 L50 60 Z" fill="white"/>
                    <circle cx="50" cy="50" r="8" fill="white"/>
                </svg>
                <span>Q-Care</span>
            </div>
            Added language selector
            <select id="languageSelect" onchange="changeLanguage()" style="padding: 0.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; background: white; color: #164e63;">
                <option value="ENGLISH">EN</option>
                <option value="KOREAN">ÌïúÍµ≠Ïñ¥</option>
                <option value="JAPANESE">Êó•Êú¨Ë™û</option>
                <option value="CHINESE">‰∏≠Êñá</option>
            </select>
        </div>
    </header>

    Main Content
    <main class="main-content">
        <div class="page-title">
            <h1 data-translate="pageTitle">Book Appointment</h1>
            <p data-translate="pageSubtitle">Select a hospital, date, and time for your appointment</p>
        </div>

        <form id="appointmentForm" action="/patient/appointment" method="POST">
            Hospital Selection
            <section class="form-section">
                <h2 data-translate="selectHospital">Select Hospital</h2>
                <div class="hospital-list" id="hospitalList">
                    Hospitals will be populated by JavaScript
                </div>
                <input type="hidden" name="hospitalId" id="selectedHospitalId">
            </section>

            Date Selection
            <section class="form-section">
                <h2 data-translate="selectDate">Select Date</h2>
                <div class="date-picker">
                    <input type="date" name="date" id="appointmentDate" required min="" class="date-input">
                </div>
            </section>

            Time Selection
            <section class="form-section">
                <h2 data-translate="selectTime">Select Time</h2>
                <div class="time-slots" id="timeSlots">
                    Time slots will be populated by JavaScript
                </div>
                <input type="hidden" name="time" id="selectedTime">
            </section>

            Submit Button
            <div class="form-actions">
                <button type="submit" class="submit-btn" id="submitBtn" disabled>
                    <span data-translate="bookAppointment">Book Appointment</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </form>
    </main>
</div>

<script>
    const translations = {
        ENGLISH: {
            pageTitle: "Book Appointment - Q-Care",
            pageSubtitle: "Select a hospital, date, and time for your appointment",
            selectHospital: "Select Hospital",
            selectDate: "Select Date",
            selectTime: "Select Time",
            bookAppointment: "Book Appointment",
            location: "Location",
            weekendService: "Weekend Service Available",
            weekendClosed: "Closed on Weekends",
            // Medical specialties
            INTERNAL_MEDICINE: "Internal Medicine",
            FAMILY_MEDICINE: "Family Medicine",
            PEDIATRICS: "Pediatrics",
            SURGERY: "Surgery",
            ORTHOPEDICS: "Orthopedics",
            NEUROLOGY: "Neurology",
            PSYCHIATRY: "Psychiatry",
            DERMATOLOGY: "Dermatology",
            OPHTHALMOLOGY: "Ophthalmology",
            ENT: "ENT",
            UROLOGY: "Urology",
            GYNECOLOGY: "Gynecology",
            CARDIOLOGY: "Cardiology",
            EMERGENCY: "Emergency",
            RADIOLOGY: "Radiology",
            ANESTHESIOLOGY: "Anesthesiology"
        },
        KOREAN: {
            pageTitle: "ÏòàÏïΩÌïòÍ∏∞ - Q-Care",
            pageSubtitle: "Î≥ëÏõê, ÎÇ†Ïßú, ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÏòàÏïΩÌïòÏÑ∏Ïöî",
            selectHospital: "Î≥ëÏõê ÏÑ†ÌÉù",
            selectDate: "ÎÇ†Ïßú ÏÑ†ÌÉù",
            selectTime: "ÏãúÍ∞Ñ ÏÑ†ÌÉù",
            bookAppointment: "ÏòàÏïΩÌïòÍ∏∞",
            location: "ÏúÑÏπò",
            weekendService: "Ï£ºÎßê ÏßÑÎ£å Í∞ÄÎä•",
            weekendClosed: "Ï£ºÎßê Ìú¥ÏßÑ",
            // Medical specialties
            INTERNAL_MEDICINE: "ÎÇ¥Í≥º",
            FAMILY_MEDICINE: "Í∞ÄÏ†ïÏùòÌïôÍ≥º",
            PEDIATRICS: "ÏÜåÏïÑÏ≤≠ÏÜåÎÖÑÍ≥º",
            SURGERY: "Ïô∏Í≥º",
            ORTHOPEDICS: "Ï†ïÌòïÏô∏Í≥º",
            NEUROLOGY: "Ïã†Í≤ΩÍ≥º",
            PSYCHIATRY: "Ï†ïÏã†Í±¥Í∞ïÏùòÌïôÍ≥º",
            DERMATOLOGY: "ÌîºÎ∂ÄÍ≥º",
            OPHTHALMOLOGY: "ÏïàÍ≥º",
            ENT: "Ïù¥ÎπÑÏù∏ÌõÑÍ≥º",
            UROLOGY: "ÎπÑÎá®ÏùòÌïôÍ≥º",
            GYNECOLOGY: "ÏÇ∞Î∂ÄÏù∏Í≥º",
            CARDIOLOGY: "Ïã¨Ïû•ÎÇ¥Í≥º",
            EMERGENCY: "ÏùëÍ∏âÏùòÌïôÍ≥º",
            RADIOLOGY: "ÏòÅÏÉÅÏùòÌïôÍ≥º",
            ANESTHESIOLOGY: "ÎßàÏ∑®ÌÜµÏ¶ùÏùòÌïôÍ≥º"
        },
        JAPANESE: {
            pageTitle: "‰∫àÁ¥Ñ„Åô„Çã - Q-Care",
            pageSubtitle: "ÁóÖÈô¢„ÄÅÊó•‰ªò„ÄÅÊôÇÈñì„ÇíÈÅ∏Êäû„Åó„Å¶‰∫àÁ¥Ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
            selectHospital: "ÁóÖÈô¢„ÇíÈÅ∏Êäû",
            selectDate: "Êó•‰ªò„ÇíÈÅ∏Êäû",
            selectTime: "ÊôÇÈñì„ÇíÈÅ∏Êäû",
            bookAppointment: "‰∫àÁ¥Ñ„Åô„Çã",
            location: "Â†¥ÊâÄ",
            weekendService: "ÈÄ±Êú´Ë®∫ÁôÇÂèØËÉΩ",
            weekendClosed: "ÈÄ±Êú´‰ºëË®∫",
            // Medical specialties
            INTERNAL_MEDICINE: "ÂÜÖÁßë",
            FAMILY_MEDICINE: "ÂÆ∂Â∫≠ÂåªÂ≠¶Áßë",
            PEDIATRICS: "Â∞èÂÖêÁßë",
            SURGERY: "Â§ñÁßë",
            ORTHOPEDICS: "Êï¥ÂΩ¢Â§ñÁßë",
            NEUROLOGY: "Á•ûÁµåÁßë",
            PSYCHIATRY: "Á≤æÁ•ûÁßë",
            DERMATOLOGY: "ÁöÆËÜöÁßë",
            OPHTHALMOLOGY: "ÁúºÁßë",
            ENT: "ËÄ≥ÈºªÂíΩÂñâÁßë",
            UROLOGY: "Ê≥åÂ∞øÂô®Áßë",
            GYNECOLOGY: "Áî£Â©¶‰∫∫Áßë",
            CARDIOLOGY: "Âæ™Áí∞Âô®Áßë",
            EMERGENCY: "ÊïëÊÄ•Áßë",
            RADIOLOGY: "ÊîæÂ∞ÑÁ∑öÁßë",
            ANESTHESIOLOGY: "È∫ªÈÖîÁßë"
        },
        CHINESE: {
            pageTitle: "È¢ÑÁ∫¶ÊåÇÂè∑ - Q-Care",
            pageSubtitle: "ÈÄâÊã©ÂåªÈô¢„ÄÅÊó•ÊúüÂíåÊó∂Èó¥ËøõË°åÈ¢ÑÁ∫¶",
            selectHospital: "ÈÄâÊã©ÂåªÈô¢",
            selectDate: "ÈÄâÊã©Êó•Êúü",
            selectTime: "ÈÄâÊã©Êó∂Èó¥",
            bookAppointment: "È¢ÑÁ∫¶ÊåÇÂè∑",
            location: "‰ΩçÁΩÆ",
            weekendService: "Âë®Êú´ÂèØËØä",
            weekendClosed: "Âë®Êú´‰ºëËØä",
            // Medical specialties
            INTERNAL_MEDICINE: "ÂÜÖÁßë",
            FAMILY_MEDICINE: "ÂÖ®ÁßëÂåªÂ≠¶",
            PEDIATRICS: "ÂÑøÁßë",
            SURGERY: "Â§ñÁßë",
            ORTHOPEDICS: "È™®Áßë",
            NEUROLOGY: "Á•ûÁªèÁßë",
            PSYCHIATRY: "Á≤æÁ•ûÁßë",
            DERMATOLOGY: "ÁöÆËÇ§Áßë",
            OPHTHALMOLOGY: "ÁúºÁßë",
            ENT: "ËÄ≥ÈºªÂñâÁßë",
            UROLOGY: "Ê≥åÂ∞øÁßë",
            GYNECOLOGY: "Â¶á‰∫ßÁßë",
            CARDIOLOGY: "ÂøÉÂÜÖÁßë",
            EMERGENCY: "ÊÄ•ËØäÁßë",
            RADIOLOGY: "ÂΩ±ÂÉèÁßë",
            ANESTHESIOLOGY: "È∫ªÈÜâÁßë"
        }
    };

    const hospitals = [
        {
            hospitalId: 1,
            name: "Seoul National University Hospital",
            location: "Jongno-gu, Seoul",
            specialties: ["INTERNAL_MEDICINE", "CARDIOLOGY", "NEUROLOGY", "SURGERY", "ORTHOPEDICS"],
            holidayService: true
        },
        {
            hospitalId: 2,
            name: "Asan Medical Center",
            location: "Songpa-gu, Seoul",
            specialties: ["SURGERY", "ORTHOPEDICS", "PEDIATRICS", "GYNECOLOGY", "EMERGENCY"],
            holidayService: false
        },
        {
            hospitalId: 3,
            name: "Samsung Medical Center",
            location: "Gangnam-gu, Seoul",
            specialties: ["DERMATOLOGY", "PSYCHIATRY", "OPHTHALMOLOGY", "ENT", "RADIOLOGY"],
            holidayService: true
        }
    ];

    const timeSlots = [
        "09:00", "09:30", "10:00", "10:30", "11:00", "11:30",
        "14:00", "14:30", "15:00", "15:30", "16:00", "16:30"
    ];

    let currentLanguage = 'ENGLISH';

    function getLanguageFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('lang') || 'ENGLISH';
    }

    function changeLanguage() {
        const select = document.getElementById('languageSelect');
        currentLanguage = select.value;

        // Update URL
        const url = new URL(window.location);
        url.searchParams.set('lang', currentLanguage);
        window.history.replaceState({}, '', url);

        applyTranslations();
        renderHospitals();
    }

    function applyTranslations() {
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.getAttribute('data-translate');
            if (translations[currentLanguage] && translations[currentLanguage][key]) {
                element.textContent = translations[currentLanguage][key];
            }
        });
    }

    function renderHospitals() {
        const hospitalList = document.getElementById('hospitalList');
        hospitalList.innerHTML = '';

        hospitals.forEach(hospital => {
            const card = document.createElement('div');
            card.className = 'hospital-card';
            card.dataset.hospitalId = hospital.hospitalId;

            const specialtyTags = hospital.specialties.slice(0, 3).map(specialty => {
                const translatedName = translations[currentLanguage][specialty] || specialty;
                return `<span class="specialty-tag">${translatedName}</span>`;
            }).join('');

            const moreCount = hospital.specialties.length > 3 ? hospital.specialties.length - 3 : 0;
            const moreTag = moreCount > 0 ? `<span class="specialty-tag">+${moreCount} more</span>` : '';

            card.innerHTML = `
                <div class="hospital-info">
                    <h3>${hospital.name}</h3>
                    <div class="hospital-details">
                        <span class="location">üìç ${hospital.location}</span>
                        <span class="${hospital.holidayService ? 'weekend-service' : 'weekend-closed'}">
                            üïí ${translations[currentLanguage][hospital.holidayService ? 'weekendService' : 'weekendClosed']}
                        </span>
                    </div>
                    <div class="specialties">
                        ${specialtyTags}
                        ${moreTag}
                    </div>
                </div>
                <div class="hospital-select">
                    <div class="radio-button"></div>
                </div>
            `;

            card.addEventListener('click', function() {
                selectHospital(hospital.hospitalId, this);
            });

            hospitalList.appendChild(card);
        });
    }

    function renderTimeSlots() {
        const timeSlotsContainer = document.getElementById('timeSlots');
        timeSlotsContainer.innerHTML = '';

        timeSlots.forEach(time => {
            const slot = document.createElement('button');
            slot.type = 'button';
            slot.className = 'time-slot';
            slot.dataset.time = time;
            slot.textContent = time;

            slot.addEventListener('click', function() {
                selectTime(time, this);
            });

            timeSlotsContainer.appendChild(slot);
        });
    }

    // Hospital selection function
    function selectHospital(hospitalId, cardElement) {
        // Remove previous selection
        document.querySelectorAll('.hospital-card').forEach(card => {
            card.classList.remove('selected');
        });

        // Add selection to clicked card
        cardElement.classList.add('selected');

        // Set hidden input value
        document.getElementById('selectedHospitalId').value = hospitalId;

        checkFormCompletion();
    }

    // Time selection function
    function selectTime(time, slotElement) {
        // Remove previous selection
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.classList.remove('selected');
        });

        // Add selection to clicked slot
        slotElement.classList.add('selected');

        // Set hidden input value
        document.getElementById('selectedTime').value = time;

        checkFormCompletion();
    }

    // Date selection listener
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('appointmentDate').addEventListener('change', checkFormCompletion);
    });

    // Check if form is complete
    function checkFormCompletion() {
        const hospitalId = document.getElementById('selectedHospitalId').value;
        const date = document.getElementById('appointmentDate').value;
        const time = document.getElementById('selectedTime').value;

        const submitBtn = document.getElementById('submitBtn');

        if (hospitalId && date && time) {
            submitBtn.disabled = false;
            submitBtn.classList.add('enabled');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.remove('enabled');
        }
    }

    function initializePage() {
        // Set minimum date to today
        document.getElementById('appointmentDate').min = new Date().toISOString().split('T')[0];

        // Get language from URL and set selector
        currentLanguage = getLanguageFromURL();
        document.getElementById('languageSelect').value = currentLanguage;

        // Apply translations and render content
        applyTranslations();
        renderHospitals();
        renderTimeSlots();
    }

    // Form submission validation
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            const hospitalId = document.getElementById('selectedHospitalId').value;
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('selectedTime').value;

            if (!hospitalId || !date || !time) {
                e.preventDefault();
                alert('Please select a hospital, date, and time for your appointment.');
            }
        });

        // Initialize page
        initializePage();
    });
</script>
</body>
</html>
